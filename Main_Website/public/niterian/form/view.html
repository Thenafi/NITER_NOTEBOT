<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../../favicon.ico" />

    <!-- HTML Meta Tags -->
    <title>NITER NOTEBOT</title>
    <meta name="description" content="Educational Platform" />

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://niternotebot.herokuapp.com/" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="NITER NOTEBOT" />
    <meta property="og:description" content="Educational Platform" />
    <meta
      property="og:image"
      content="https://cdn.statically.io/og/Data Entry NITERNOTEBOT.jpg"
    />

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta property="twitter:domain" content="niternotebot.herokuapp.com" />
    <meta
      property="twitter:url"
      content="https://niternotebot.herokuapp.com/"
    />
    <meta name="twitter:title" content="NITER NOTEBOT" />
    <meta name="twitter:description" content="Educational Platform" />
    <meta
      name="twitter:image"
      content="https://cdn.statically.io/og/Data Entry NITERNOTEBOT.jpg"
    />

    <title>NITER NOTEBOT</title>
    <style>
      @import url("https://fonts.googleapis.com/css?family=Montserrat:400,400i,700");
      body {
        font-size: 16px;
        color: #404040;
        font-family: sans-serif;
        background: linear-gradient(
          43deg,
          rgba(53, 161, 239, 1) 36%,
          rgba(78, 219, 212, 1) 100%
        );

        /* background-image: linear-gradient(
          to bottom right,
          #c4f2f0 0% 65%,
          #8cedfc 95% 100%
        ); */
        background-position: center;
        background-attachment: fixed;
        margin-top: 2rem;
        display: grid;
        place-items: center;
        box-sizing: border-box;
      }

      .card {
        background-color: #fff;
        max-width: 360px;
        display: none;
        align-items: center;
        flex-direction: column;
        overflow: none;
        border-radius: 1.5rem;
        box-shadow: 0px 1rem 1.5rem rgba(0, 0, 0, 0.2);
        width: 90%;
        height: auto;
        margin-bottom: 40px;
        padding: 10px;
      }
      .card .banner {
        background-color: rgb(157, 209, 255);
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        width: -webkit-fill-available;
        height: 9rem;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        border-top-left-radius: 1.5rem;
        border-top-right-radius: 1.5rem;
        box-sizing: border-box;
      }
      .card .banner svg {
        background-color: #fff;
        width: 8rem;
        height: 8rem;
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.3);
        border-radius: 50%;
        transform: translateY(50%);
        transition: transform 200ms cubic-bezier(0.18, 0.89, 0.32, 1.28);
      }
      .card .banner svg:hover {
        transform: translateY(50%) scale(1.3);
      }
      .card h2.name {
        text-align: center;
        margin: 0;
      }
      .card .detl {
        margin: 30px 0;
      }
      .card .title {
        color: #00e0ff;
        font-size: 1rem;
        font-weight: 700;
        text-align: center;
        padding: 0 2rem 1.2rem;
      }
      .card .desc {
        text-align: center;
        order: 100;
      }

      .lnk {
        text-decoration: none;
        color: #777;
      }
      .lnk:hover {
        color: #0099ff;
      }
      .loader {
        border: 16px solid #f3f3f3; /* Light grey */
        border-top: 16px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .card h2.name.skeleton {
        min-height: 27px;
        margin: 10px;
        border-radius: 4px;
      }
      .card .banner.skeleton {
        width: 100px;
        height: 100px;

        border-radius: 4px;
      }
      .card .title.skeleton {
        margin: 10px;
        border-radius: 4px;
      }
      .card .desc.skeleton {
        margin: 10px;
        min-height: 72px;
        border-radius: 4px;
      }
      .skeleton {
        background-color: #e2e5e7;
        background-image: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0),
          rgba(255, 255, 255, 0.5),
          rgba(255, 255, 255, 0)
        );
        background-size: 40px 100%;
        background-repeat: no-repeat;
        background-position: left -40px top 0;
        animation: shine 1s ease infinite;
      }
      @keyframes shine {
        to {
          background-position: right -40px top 0;
        }
      }

      .smlicon {
        width: 15px;
        padding-right: 10px;
      }

      .searchbox {
        display: flex;
        align-items: center;
        justify-content: space-around;
        max-width: 360px;
        width: 90%;
        margin-top: 150px;
      }
      .input {
        border-radius: 5px;
        padding: 10px;
        border: 1px solid #777;
        display: block;
      }
      #searchButton {
        padding: 10px;
        border: none;
        border-radius: 5px;
        width: 90px;
        background-color: #fff;
        box-shadow: 0px 1rem 1.5rem rgba(0, 0, 0, 0.1);
      }

      #searchButton:hover {
        background-color: greenyellow;
      }

      .add {
        padding: 10px 20px;
        border: 1px solid;
        border-radius: 5px;
        background-color: rgb(255, 255, 255);
        color: #404040;
        cursor: pointer;
        text-decoration: none;
    
      }

      .add:hover {
        background-color: #0099ff;
        color: #fff;
      }

      .dwnbtm{
        display: block;
      }

      .dwn{
        margin: 20px 10px 0 0;
      }

      #updtbtn{
        font-size: 13.333px;
      }
      
      #more {
        display: none;
      }

    </style>
  </head>

  <body>
    <p class="disclaim" id="disclaim" style="text-align: center">
      Search Niterian by their ID. ID format should be like "TE-1808151".
      Without using proper ID format you won't find any result.
    </p>

    <div id="card" class="card">
      <div class="banner">
        <img id="initial_image" width="100" height="100" />
      </div>
      <div id="catLaughed" style="height: 50%; width: 80%; margin: 30px 0">
        <h2 class="name">---</h2>
        <div class="title">---</div>
        <div class="desc">
          --- <br />
          --- <br />
          --- <br />
          --- <br />
        </div>
      </div>
    </div>
    <div class="searchbox" id="searchbox">
      <input
        autocomplete="off"
        id="myTextInputID"
        name="search"
        class="input"
        type="text"
        placeholder="Search by ID"
        style="text-align: center"
      />

      <button id="searchButton">search</button>
    </div>
    <script src="./html2canvas.js"></script>
    <script>
      let input = document.getElementById("myTextInputID");
      const initial_image = document.getElementById("initial_image");
      const searchButtonElement = document.getElementById("searchButton");
      const disclaimElement = document.getElementById("disclaim");
      const genRand = (len) => {
        return Math.random()
          .toString(36)
          .substring(2, len + 2);
      };

      initial_image.setAttribute(
        "src",
        `https://avatars.dicebear.com/api/pixel-art/${genRand(5)}.svg`
      );

      input.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
          searchButtonElement.click();
        }
      });
      searchButtonElement.addEventListener("click", () => {
        if (checkInputs()) {
          getData();
        } else {
          document.getElementById("disclaim").style.display = "block";
          disclaimElement.innerHTML = `
          <h1 style="background-color:Tomato; border-radius: 5px; padding:5px">Wrong Id Format. Please write like this "TE-1808151"</h1>
          `;
        }
      });
      const checkInputs = function () {
        if (input.value.length === 10) {
          let re = new RegExp(/[A-Z]{2}-[0-9]{7}/, "i");
          if (re.test(input.value)) {
            return true;
          } else {
            return new Error("Format Wrong"), false;
          }
        } else {
          return new Error("Lenght Wrong"), false;
        }
      };
      const expnd = function () {
        document.getElementById("more").style.display = "block";
        document.getElementById("btn").style.display = "none";
      };

      const sharebtn = function () {
        document.getElementById("share").style.display = "none";
        document.getElementById("updtbtn").style.display = "none";

        html2canvas(document.getElementById("card"), { useCORS: true }).then(
          function (canvas) {
            document.body.appendChild(canvas);
            const elemetn = document.getElementsByTagName("canvas");
            for (let i = 0; i < elemetn.length; i++) {
              elemetn[i].style.display = "none";
            }

            if (navigator.canShare) {
              async function shareCanvas() {
                const canvasElement =
                  document.getElementsByTagName("canvas")[0];
                console.log(canvasElement);
                const dataUrl = canvasElement.toDataURL();
                const blob = await (await fetch(dataUrl)).blob();
                const filesArray = [
                  new File([blob], "ID.png", {
                    type: blob.type,
                    lastModified: new Date().getTime(),
                  }),
                ];
                const shareData = {
                  files: filesArray,
                };
                navigator.share(shareData);
              }
              shareCanvas();
            } else {
              alert(
                "Your browser doesnot support share. Try a different browser."
              );
              console.log("failed");
            }
          }
        );
      };

      const getData = function () {
        document.getElementById("card").style.display = "flex";
        document.getElementById("searchbox").style.margin = "0";
        document.getElementById("disclaim").style.display = "none";

        let loader = `
              <h2 class="name skeleton" ></h2>
              <div class="title skeleton"></div>
              <div class="desc skeleton">
                `;
        document.getElementById("catLaughed").innerHTML = loader;
        fetch("https://niternotebot.herokuapp.com/search/", {
          method: "POST",
          headers: {
            Accept: "application/json",
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            id: document.getElementById("myTextInputID").value.toUpperCase(),
          }),
        })
          .then((response) => response.json())
          .then(function (data) {
            let result;
            if (data) {
              result = `
                  <div class="banner">
                    <img
                      src="https://avatars.dicebear.com/api/${
                        data.gender === "M" ? "male" : "female"
                      }/${data.name.split(" ")[0]}.svg?size=100"
                      width="100"
                      height="100"
                    />
                  </div>
                  <div id="catLaughed" class="detl" style="height: 50%;width: 80%">

                  <h2 class="name">${data.name}</h2>
                  <div class="title">${data.id}</div>
                  <div class="desc" id="catLaughed">
                      NITER ${data.batch}th Batch <br>
                      From ${data.htown} <br>
                      Department of ${data.dept} <br>
                      Section: ${data.sec}<br><br>
                      <button onclick="expnd()" class="add" id="btn">See More</button>
                      <div id="more">
                      Blood Group: ${data.blood} <br><br>
                      Email: <a href="mailto:${data.email}" class="lnk">${
                data.email
              }</a>
                      <br/><br/>
                      Phone: <a href="tel:${data.phone}" class="lnk">${
                data.phone
              }</a>
              <div class="dwnbtm">
                      <button onclick="sharebtn()" class="add dwn" id="share"><img src="./share.svg" class="smlicon"/>Share</button>

                        <a href="#" class="add dwn" id="updtbtn"><img src="./update.svg" class="smlicon"/>Update</a>


              </div>
                      </div>
                      </div>
                </div>

            `;
            } else {
              result = `
            <div class="banner">
              <img
                src="https://avatars.dicebear.com/api/pixel-art/nafi.svg"
                width="100"
                height="100"
              />
            </div>
            <div id="catLaughed" style="height: 50%;width: 80%; margin: 30px 0">
              <h2 class="name" style ='color: red'> No Data Found</h2>
              <div class="title"> --- </div>
              <div class="desc">
                Please Check the ID <br><br>
                Or <br><br>
                <a href="./index.html" class= "add">Add New Data</a>


              </div>
            </div>
                    `;
            }
            document.getElementById("card").innerHTML = result;
          });
      };
    </script>
  </body>
</html>
